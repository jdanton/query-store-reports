"use strict";(()=>{function K(e){let n=new DOMParser().parseFromString(e,"application/xml");if(n.querySelector("parsererror"))return null;let o=n.querySelector("StmtSimple > QueryPlan > RelOp")??n.querySelector("StmtCursor > QueryPlan > RelOp")??n.querySelector("RelOp");if(!o)return null;let r=parseFloat(o.getAttribute("TotalSubtreeCost")??"1")||1;return P(o,r)}function P(e,t){let n=parseFloat(e.getAttribute("TotalSubtreeCost")??"0"),a=[];for(let s of e.children){let c=s.querySelectorAll(":scope > RelOp");for(let p of c)a.push(P(p,t));if(s.tagName!=="RelOp")for(let p of s.querySelectorAll("RelOp"))p.parentElement===s&&a.push(P(p,t))}let o=new Set,r=[],l=e.querySelectorAll(":scope > * > RelOp");for(let s of l)o.has(s)||(o.add(s),r.push(P(s,t)));return{physicalOp:e.getAttribute("PhysicalOp")??"Unknown",logicalOp:e.getAttribute("LogicalOp")??"",estimateRows:parseFloat(e.getAttribute("EstimateRows")??"0"),estimateCpu:parseFloat(e.getAttribute("EstimateCPU")??"0"),estimateIo:parseFloat(e.getAttribute("EstimateIO")??"0"),estimateRebinds:parseFloat(e.getAttribute("EstimateRebinds")??"0"),estimateRewinds:parseFloat(e.getAttribute("EstimateRewinds")??"0"),avgRowSize:parseFloat(e.getAttribute("AvgRowSize")??"0"),totalSubtreeCost:n,relOpCost:t>0?n/t:0,parallelism:e.getAttribute("Parallel")==="1",nodeId:parseInt(e.getAttribute("NodeId")??"0",10),children:r.length>0?r:a,x:0,y:0,width:130,height:60}}function Z(e){if(e.children.length===0)return e.width=130,e.height=60,{w:130,h:60};let t=e.children.map(Z),n=t.reduce((o,r)=>o+r.w,0)+30*(e.children.length-1),a=Math.max(...t.map(o=>o.h));return e.width=Math.max(130,n),e.height=60,{w:e.width,h:110+a}}function J(e,t,n){if(e.x=t+(e.width-130)/2,e.y=n,e.children.length===0)return;let a=e.children.reduce((r,l)=>r+l.width,0)+30*(e.children.length-1),o=t+(e.width-a)/2;for(let r of e.children)J(r,o,n+60+50),o+=r.width+30}function ee(e){let t=e.x,n=e.y,a=e.x+130,o=e.y+60;for(let r of e.children){let l=ee(r);t=Math.min(t,l.minX),n=Math.min(n,l.minY),a=Math.max(a,l.maxX),o=Math.max(o,l.maxY)}return{minX:t,minY:n,maxX:a,maxY:o}}function de(e){return`hsl(${Math.round((1-Math.min(e,1))*120)}, 70%, 45%)`}function $(e){return e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function X(e,t){return e.length>t?e.slice(0,t-1)+"\u2026":e}function te(e,t,n){let a=e.x,o=e.y,r=130,l=60,i=(e.relOpCost*100).toFixed(1),s=de(e.relOpCost),c="#fff",p=[`Physical Op: ${e.physicalOp}`,`Logical Op: ${e.logicalOp}`,`Est. Rows: ${e.estimateRows.toFixed(0)}`,`Est. CPU: ${e.estimateCpu.toExponential(2)}`,`Est. I/O: ${e.estimateIo.toExponential(2)}`,`Subtree Cost: ${e.totalSubtreeCost.toFixed(4)}`,`Cost %: ${i}%`,`Parallelism: ${e.parallelism?"Yes":"No"}`].join(`
`);t.push(`<g class="plan-node" data-node-id="${e.nodeId}" data-tooltip="${$(p)}"><rect x="${a}" y="${o}" width="${r}" height="${l}" rx="4" fill="${s}" /><text x="${a+r/2}" y="${o+18}" text-anchor="middle" fill="${c}" font-size="11" font-weight="600">${$(X(e.physicalOp,18))}</text><text x="${a+r/2}" y="${o+32}" text-anchor="middle" fill="${c}" font-size="10" opacity="0.85">${$(X(e.logicalOp,20))}</text><text x="${a+r/2}" y="${o+48}" text-anchor="middle" fill="${c}" font-size="10" opacity="0.8">Cost: ${i}%  Rows: ${e.estimateRows.toFixed(0)}</text></g>`);for(let h of e.children){let j=a+r/2,Q=o+l,Y=h.x+130/2,U=h.y,V=(Q+U)/2;t.push(`<path d="M${j},${Q} C${j},${V} ${Y},${V} ${Y},${U}" fill="none" stroke="var(--vscode-editorWidget-border,#666)" stroke-width="1.5" opacity="0.7"/>`),te(h,t,n)}}function ne(e){Z(e),J(e,0,0);let t=ee(e),n=20,a=t.maxX-t.minX+n*2,o=t.maxY-t.minY+n*2,r=i=>{i.x-=t.minX-n,i.y-=t.minY-n;for(let s of i.children)r(s)};r(e);let l=[];return te(e,l,()=>{}),`<svg xmlns="http://www.w3.org/2000/svg" width="${a}" height="${o}" viewBox="0 0 ${a} ${o}" style="display:block">
  <style>
    .plan-node rect { cursor: pointer; transition: opacity 0.15s; }
    .plan-node:hover rect { opacity: 0.85; }
    .plan-node text { pointer-events: none; font-family: var(--vscode-font-family, monospace); }
  </style>
  ${l.join(`
  `)}
</svg>`}var D=acquireVsCodeApi(),R=document.getElementById("app"),d=document.getElementById("toolbar"),S=document.getElementById("status-bar"),Pe=document.getElementById("main-content"),ae=document.getElementById("chart-section"),B=document.getElementById("grid-container"),le=document.getElementById("drilldown-section"),ue=document.getElementById("drilldown-title"),me=document.getElementById("drilldown-close"),pe=document.getElementById("plan-container"),_=document.getElementById("plan-canvas"),L=document.getElementById("plan-tooltip"),F=document.getElementById("force-plan-btn"),G=document.getElementById("unforce-plan-btn"),ge=document.getElementById("plan-zoom-fit"),ye=document.getElementById("plan-zoom-in"),be=document.getElementById("plan-zoom-out"),g=R.dataset.reportType,T=R.dataset.defaultNow,M=R.dataset.defaultMinus1h,Oe=R.dataset.defaultMinus7d,fe=R.dataset.defaultMinus30d,y={},q=[],x=null,C=null,E=1,he=null,I=null,A=null;function oe(e){let t=new Date(e),n=a=>String(a).padStart(2,"0");return`${t.getFullYear()}-${n(t.getMonth()+1)}-${n(t.getDate())}T${n(t.getHours())}:${n(t.getMinutes())}`}function v(e){let t=document.createElement("label");return t.className="qs-label",t.textContent=e,t}function w(e,t,n){let a=document.createElement("input");if(a.type=e,a.value=t,a.className="qs-input",n)for(let[o,r]of Object.entries(n))a.setAttribute(o,r);return a}function N(e,t){let n=document.createElement("select");n.className="qs-select";for(let a of e){let o=document.createElement("option");o.value=a.value,o.textContent=a.label,a.value===t&&(o.selected=!0),n.appendChild(o)}return n}function ve(){let e=document.createElement("button");return e.textContent="\u21BB Refresh",e.className="qs-btn qs-btn-primary",e}function b(...e){let t=document.createElement("div");t.className="qs-toolbar-group";for(let n of e)t.appendChild(n);return t}var se=[{value:"1h",label:"Last 1 hour"},{value:"4h",label:"Last 4 hours"},{value:"24h",label:"Last 24 hours"},{value:"7d",label:"Last 7 days"},{value:"30d",label:"Last 30 days"},{value:"custom",label:"Custom\u2026"}];function W(e){let t=new Date,n=a=>a*36e5;switch(e){case"1h":return{start:new Date(Date.now()-n(1)),end:t};case"4h":return{start:new Date(Date.now()-n(4)),end:t};case"24h":return{start:new Date(Date.now()-n(24)),end:t};case"7d":return{start:new Date(Date.now()-n(168)),end:t};case"30d":return{start:new Date(Date.now()-n(720)),end:t};default:return{start:new Date(Date.now()-n(1)),end:t}}}function O(e){let t=N(se,e),n=w("datetime-local",oe(M),{style:"display:none"}),a=w("datetime-local",oe(T),{style:"display:none"}),o=()=>{let r=t.value==="custom";n.style.display=r?"":"none",a.style.display=r?"":"none"};return t.addEventListener("change",o),{elements:[v("Time Range:"),t,n,v("to"),a],getStart:()=>t.value==="custom"?new Date(n.value).toISOString():W(t.value).start.toISOString(),getEnd:()=>t.value==="custom"?new Date(a.value).toISOString():new Date().toISOString()}}function _e(){d.innerHTML="";let e=ve();if(g==="topResources"){let{elements:t,getStart:n,getEnd:a}=O("1h"),o=w("number","25",{min:"1",max:"200",style:"width:70px"}),r=N([{value:"duration",label:"Duration (ms)"},{value:"cpu",label:"CPU Time (ms)"},{value:"logicalReads",label:"Logical IO Reads"},{value:"logicalWrites",label:"Logical IO Writes"},{value:"physicalReads",label:"Physical IO Reads"},{value:"memory",label:"Memory (KB)"},{value:"rowcount",label:"Row Count"}],"duration");d.appendChild(b(...t)),d.appendChild(b(v("Metric:"),r)),d.appendChild(b(v("Top:"),o)),d.appendChild(e),e.addEventListener("click",()=>{y={intervalStartTime:n(),intervalEndTime:a(),resultsRowCount:parseInt(o.value,10)||25,metric:r.value,replicaGroupId:1},k()}),y={intervalStartTime:M,intervalEndTime:T,resultsRowCount:25,metric:"duration",replicaGroupId:1}}else if(g==="regressed"){let t=N(se.slice(0,5),"1h"),n=N([{value:"7d",label:"Last 7 days (history)"},{value:"30d",label:"Last 30 days (history)"}],"7d"),a=w("number","1",{min:"1",style:"width:60px"}),o=w("number","25",{min:"1",max:"200",style:"width:70px"});d.appendChild(b(v("Recent Period:"),t)),d.appendChild(b(v("History Period:"),n)),d.appendChild(b(v("Min Executions:"),a)),d.appendChild(b(v("Top:"),o)),d.appendChild(e);let r=()=>{let l=W(t.value),i=W(n.value);return{recentStartTime:l.start.toISOString(),recentEndTime:l.end.toISOString(),historyStartTime:i.start.toISOString(),historyEndTime:i.end.toISOString(),minExecCount:parseInt(a.value,10)||1,resultsRowCount:parseInt(o.value,10)||25,replicaGroupId:1}};e.addEventListener("click",()=>{y=r(),k()}),y=r()}else if(g==="highVariation"){let{elements:t,getStart:n,getEnd:a}=O("1h"),o=w("number","25",{min:"1",max:"200",style:"width:70px"});d.appendChild(b(...t)),d.appendChild(b(v("Top:"),o)),d.appendChild(e),e.addEventListener("click",()=>{y={intervalStartTime:n(),intervalEndTime:a(),resultsRowCount:parseInt(o.value,10)||25,replicaGroupId:1},k()}),y={intervalStartTime:M,intervalEndTime:T,resultsRowCount:25,replicaGroupId:1}}else if(g==="waitStats"){let{elements:t,getStart:n,getEnd:a}=O("1h"),o=w("number","10",{min:"1",max:"100",style:"width:70px"});d.appendChild(b(...t)),d.appendChild(b(v("Top:"),o)),d.appendChild(e),e.addEventListener("click",()=>{y={intervalStartTime:n(),intervalEndTime:a(),resultsRowCount:parseInt(o.value,10)||10,replicaGroupId:1},k()}),y={intervalStartTime:M,intervalEndTime:T,resultsRowCount:10,replicaGroupId:1}}else if(g==="forcedPlans")d.appendChild(e),e.addEventListener("click",()=>{y={replicaGroupId:1},k()}),y={replicaGroupId:1};else if(g==="overallConsumption"){let{elements:t,getStart:n,getEnd:a}=O("30d"),o=[{key:"total_duration",label:"Duration (ms)"},{key:"total_cpu_time",label:"CPU Time (ms)"},{key:"total_logical_io_reads",label:"Logical Reads (KB)"},{key:"total_logical_io_writes",label:"Logical Writes (KB)"},{key:"total_physical_io_reads",label:"Physical Reads (KB)"},{key:"total_query_wait_time",label:"Wait Time (ms)"},{key:"total_query_max_used_memory",label:"Memory (KB)"},{key:"total_rowcount",label:"Row Count"}],r={},l=b(v("Show:"));for(let i of o){let s=document.createElement("input");s.type="checkbox",s.id=`cb-${i.key}`,s.checked=["total_duration","total_cpu_time","total_query_wait_time"].includes(i.key),s.addEventListener("change",()=>ie(q)),r[i.key]=s;let c=document.createElement("label");c.htmlFor=s.id,c.textContent=i.label,c.style.marginLeft="2px",c.style.marginRight="10px",l.appendChild(s),l.appendChild(c)}R._consumptionCheckboxes=r,d.appendChild(b(...t)),d.appendChild(l),d.appendChild(e),e.addEventListener("click",()=>{y={intervalStartTime:n(),intervalEndTime:a(),replicaGroupId:1},k()}),y={intervalStartTime:fe,intervalEndTime:T,replicaGroupId:1}}}function k(){H("loading"),D.postMessage({type:"refresh",params:y})}function H(e,t){S.classList.remove("hidden","loading","error","ok"),e==="loading"?(S.classList.add("loading"),S.textContent="\u23F3 Loading\u2026"):e==="error"?(S.classList.add("error"),S.textContent="\u26A0 "+(t??"Unknown error")):S.classList.add("hidden")}var u=["#4e79a7","#f28e2b","#e15759","#76b7b2","#59a14f","#edc948","#b07aa1","#ff9da7","#9c755f","#bab0ac"];function ie(e){if(x&&(x.destroy(),x=null),g==="forcedPlans"){ae.style.display="none";return}ae.style.display="";let t=document.getElementById("main-chart");g==="topResources"||g==="highVariation"?ke(t,e):g==="regressed"?Ee(t,e):g==="waitStats"?we(t,e):g==="overallConsumption"&&xe(t,e)}function ce(e){let t=e.object_name,a=(e.query_sql_text??"").replace(/\s+/g," ").trim().slice(0,60);return t?`[${t}] ${a}`:a}function ke(e,t){let n=g==="topResources"?"metric_value":"variation_duration",a=t.map(r=>ce(r)),o=t.map(r=>r[n]??0);x=new Chart(e,{type:"bar",data:{labels:a,datasets:[{label:g==="topResources"?String(y.metric??"Duration"):"Variation",data:o,backgroundColor:u[0]+"cc",borderColor:u[0],borderWidth:1}]},options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{x:{beginAtZero:!0,ticks:{color:"var(--vscode-foreground)"},grid:{color:"var(--vscode-editorWidget-border)"}},y:{ticks:{color:"var(--vscode-foreground)",font:{size:11}},grid:{display:!1}}},onClick:(r,l)=>{if(l.length>0){let i=l[0].index;z(t[i])}}}})}function Ee(e,t){let n=t.map(a=>ce(a));x=new Chart(e,{type:"bar",data:{labels:n,datasets:[{label:"Recent Duration (ms)",data:t.map(a=>a.total_duration_recent??0),backgroundColor:u[0]+"cc",borderColor:u[0],borderWidth:1},{label:"Historical Duration (ms)",data:t.map(a=>a.total_duration_hist??0),backgroundColor:u[1]+"cc",borderColor:u[1],borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{labels:{color:"var(--vscode-foreground)"}}},scales:{x:{ticks:{color:"var(--vscode-foreground)",font:{size:10}},grid:{display:!1}},y:{beginAtZero:!0,ticks:{color:"var(--vscode-foreground)"},grid:{color:"var(--vscode-editorWidget-border)"}}},onClick:(a,o)=>{o.length>0&&z(t[o[0].index])}}})}function we(e,t){let n=t.map(o=>o.wait_category_desc),a=t.map(o=>o.total_query_wait_time??0);x=new Chart(e,{type:"bar",data:{labels:n,datasets:[{label:"Total Wait Time (ms)",data:a,backgroundColor:u.slice(0,t.length).map(o=>o+"cc"),borderColor:u.slice(0,t.length),borderWidth:1}]},options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{x:{beginAtZero:!0,ticks:{color:"var(--vscode-foreground)"},grid:{color:"var(--vscode-editorWidget-border)"}},y:{ticks:{color:"var(--vscode-foreground)"},grid:{display:!1}}}}})}var Ce=[{key:"total_duration",label:"Duration (ms)",color:u[0]},{key:"total_cpu_time",label:"CPU Time (ms)",color:u[1]},{key:"total_logical_io_reads",label:"Logical Reads",color:u[2]},{key:"total_logical_io_writes",label:"Logical Writes",color:u[3]},{key:"total_physical_io_reads",label:"Physical Reads",color:u[4]},{key:"total_query_wait_time",label:"Wait Time (ms)",color:u[5]},{key:"total_query_max_used_memory",label:"Memory (KB)",color:u[6]},{key:"total_rowcount",label:"Row Count",color:u[7]}];function xe(e,t){let n=t.map(r=>new Date(r.bucket_start).toLocaleDateString()),a=R._consumptionCheckboxes,o=Ce.filter(r=>a?.[r.key]?.checked??!0).map(r=>({label:r.label,data:t.map(l=>l[r.key]??0),borderColor:r.color,backgroundColor:r.color+"33",borderWidth:2,pointRadius:3,tension:.2,fill:!1}));x=new Chart(e,{type:"line",data:{labels:n,datasets:o},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{labels:{color:"var(--vscode-foreground)",font:{size:11}}}},scales:{x:{ticks:{color:"var(--vscode-foreground)",font:{size:10}},grid:{color:"var(--vscode-editorWidget-border)"}},y:{beginAtZero:!0,ticks:{color:"var(--vscode-foreground)"},grid:{color:"var(--vscode-editorWidget-border)"}}}}})}var Re={topResources:[{key:"query_id",label:"Query ID"},{key:"object_name",label:"Object"},{key:"metric_value",label:"Metric",fmt:m},{key:"total_duration",label:"Total Dur (ms)",fmt:m},{key:"count_executions",label:"Executions",fmt:f},{key:"num_plans",label:"Plans",fmt:f},{key:"query_sql_text",label:"SQL Text"}],regressed:[{key:"query_id",label:"Query ID"},{key:"object_name",label:"Object"},{key:"additional_duration_workload",label:"Extra Duration",fmt:m},{key:"total_duration_recent",label:"Recent (ms)",fmt:m},{key:"total_duration_hist",label:"History (ms)",fmt:m},{key:"count_executions_recent",label:"Exec (Recent)",fmt:f},{key:"count_executions_hist",label:"Exec (History)",fmt:f},{key:"num_plans",label:"Plans",fmt:f},{key:"query_sql_text",label:"SQL Text"}],highVariation:[{key:"query_id",label:"Query ID"},{key:"object_name",label:"Object"},{key:"variation_duration",label:"Variation",fmt:m},{key:"stdev_duration",label:"StdDev (ms)",fmt:m},{key:"avg_duration",label:"Avg (ms)",fmt:m},{key:"count_executions",label:"Executions",fmt:f},{key:"num_plans",label:"Plans",fmt:f},{key:"query_sql_text",label:"SQL Text"}],waitStats:[{key:"wait_category_desc",label:"Wait Type"},{key:"total_query_wait_time",label:"Total (ms)",fmt:m},{key:"avg_query_wait_time",label:"Avg (ms)",fmt:m},{key:"max_query_wait_time",label:"Max (ms)",fmt:m},{key:"min_query_wait_time",label:"Min (ms)",fmt:m},{key:"stdev_query_wait_time",label:"StdDev (ms)",fmt:m},{key:"count_executions",label:"Executions",fmt:f}],forcedPlans:[{key:"query_id",label:"Query ID"},{key:"object_name",label:"Object"},{key:"plan_id",label:"Plan ID"},{key:"last_execution_time",label:"Last Executed",fmt:re},{key:"force_failure_count",label:"Force Failures",fmt:f},{key:"last_force_failure_reason_desc",label:"Last Failure Reason"},{key:"num_plans",label:"Plans",fmt:f},{key:"query_sql_text",label:"SQL Text"}],overallConsumption:[{key:"bucket_start",label:"Date",fmt:re},{key:"total_count_executions",label:"Executions",fmt:f},{key:"total_duration",label:"Duration (ms)",fmt:m},{key:"total_cpu_time",label:"CPU (ms)",fmt:m},{key:"total_logical_io_reads",label:"Log Reads (KB)",fmt:m},{key:"total_physical_io_reads",label:"Phys Reads (KB)",fmt:m},{key:"total_query_wait_time",label:"Wait (ms)",fmt:m},{key:"total_query_max_used_memory",label:"Memory (KB)",fmt:m},{key:"total_rowcount",label:"Row Count",fmt:f}]};function m(e){let t=Number(e);return isNaN(t)?"":t.toLocaleString(void 0,{maximumFractionDigits:2})}function f(e){let t=Number(e);return isNaN(t)?"":t.toLocaleString()}function re(e){return e?new Date(e).toLocaleString():""}function Se(e){let t=Re[g]??[];if(t.length===0||e.length===0){B.innerHTML='<div class="qs-empty">No data returned.</div>';return}let n=document.createElement("table");n.className="qs-table";let a=document.createElement("thead"),o=document.createElement("tr");for(let l of t){let i=document.createElement("th");i.textContent=l.label,o.appendChild(i)}if(g==="forcedPlans"){let l=document.createElement("th");l.textContent="Actions",o.appendChild(l)}a.appendChild(o),n.appendChild(a);let r=document.createElement("tbody");for(let l=0;l<e.length;l++){let i=e[l],s=document.createElement("tr");s.addEventListener("click",c=>{c.target.tagName!=="BUTTON"&&z(i)});for(let c of t){let p=document.createElement("td"),h=i[c.key];c.key==="query_sql_text"?(p.className="qs-sql-cell",p.title=String(h??""),p.textContent=String(h??"").replace(/\s+/g," ").trim().slice(0,80)+(String(h??"").length>80?"\u2026":"")):p.textContent=c.fmt?c.fmt(h):String(h??""),s.appendChild(p)}if(g==="forcedPlans"){let c=document.createElement("td"),p=document.createElement("button");p.className="qs-btn qs-btn-sm qs-btn-danger",p.textContent="Remove Forced Plan",p.addEventListener("click",h=>{h.stopPropagation(),D.postMessage({type:"removeForcedPlan",queryId:i.query_id})}),c.appendChild(p),s.appendChild(c)}r.appendChild(s)}n.appendChild(r),B.innerHTML="",B.appendChild(n)}function z(e){let t=e.query_id,n=e.plan_id??1;t&&(I=t,A=n,ue.textContent=`Query ${t} \u2014 Execution Statistics & Plan`,le.classList.remove("hidden"),_.innerHTML='<div class="qs-plan-loading">Loading plan\u2026</div>',F.style.display="none",G.style.display="none",D.postMessage({type:"drilldown",queryId:t,planId:n,params:y}))}me.addEventListener("click",()=>{le.classList.add("hidden"),C&&(C.destroy(),C=null),_.innerHTML=""});F.addEventListener("click",()=>{I!==null&&A!==null&&D.postMessage({type:"forcePlan",queryId:I,planId:A})});G.addEventListener("click",()=>{I!==null&&D.postMessage({type:"removeForcedPlan",queryId:I})});function Le(e){C&&(C.destroy(),C=null);let t=document.getElementById("drilldown-chart"),a=[...new Set(e.map(r=>r.plan_id))].map((r,l)=>{let i=e.filter(s=>s.plan_id===r).sort((s,c)=>new Date(s.bucket_start).getTime()-new Date(c.bucket_start).getTime());return{label:`Plan ${r}`,data:i.map(s=>({x:new Date(s.bucket_start).toLocaleString(),y:s.avg_duration})),borderColor:u[l%u.length],backgroundColor:u[l%u.length]+"33",borderWidth:2,pointRadius:3,tension:.2,fill:!1}}),o=[...new Set(e.map(r=>new Date(r.bucket_start).toLocaleString()))].sort();C=new Chart(t,{type:"line",data:{labels:o,datasets:a},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{labels:{color:"var(--vscode-foreground)",font:{size:11}}}},scales:{x:{ticks:{color:"var(--vscode-foreground)",font:{size:10}},grid:{color:"var(--vscode-editorWidget-border)"}},y:{beginAtZero:!0,title:{display:!0,text:"Avg Duration (ms)",color:"var(--vscode-foreground)"},ticks:{color:"var(--vscode-foreground)"},grid:{color:"var(--vscode-editorWidget-border)"}}}}})}function Te(e,t){let n=K(e);if(!n){_.innerHTML='<div class="qs-plan-loading">Could not parse query plan XML.</div>';return}he=n;let a=ne(n);_.innerHTML=a,E=1,_.querySelectorAll(".plan-node").forEach(o=>{o.addEventListener("mouseenter",r=>{let i=r.currentTarget.dataset.tooltip??"";L.textContent=i,L.classList.remove("hidden")}),o.addEventListener("mouseleave",()=>{L.classList.add("hidden")}),o.addEventListener("mousemove",r=>{let l=r,i=pe.getBoundingClientRect();L.style.left=l.clientX-i.left+12+"px",L.style.top=l.clientY-i.top+12+"px"})}),F.style.display=t?"none":"",G.style.display=t?"":"none"}ye.addEventListener("click",()=>{E=Math.min(E*1.25,5),_.style.transform=`scale(${E})`,_.style.transformOrigin="top left"});be.addEventListener("click",()=>{E=Math.max(E/1.25,.2),_.style.transform=`scale(${E})`,_.style.transformOrigin="top left"});ge.addEventListener("click",()=>{E=1,_.style.transform=""});window.addEventListener("message",e=>{let t=e.data;switch(t.type){case"loading":H("loading");break;case"data":{q=t.rows??[],H("ok"),ie(q),Se(q);break}case"error":H("error",t.message);break;case"drilldownData":{let n=t.rows??[];Le(n);break}case"planData":{let n=t.xml;n?Te(n,!!t.isForcedPlan):_.innerHTML='<div class="qs-plan-loading">No query plan available for this query.</div>';break}case"forcePlanResult":case"removeForcedPlanResult":k();break}});_e();k();})();
